# 视频与图文内容管理系统 - 数据库设计说明

## 📋 概述

本文档说明了视频与图文内容管理与分发平台的数据库表结构设计，共包含 **14张核心业务表**。

所有表名统一以 `t_` 开头，符合规范命名约定。

## 🗂️ 表结构清单

### 1️⃣ 基础配置模块（3张表）

#### 1. t_material_category - 素材分类信息表
统一管理视频和图文素材的分类信息。

**核心字段：**
- `category_code`: 分类编码（唯一标识）
- `category_name`: 分类名称
- `category_type`: 分类类型（1-视频分类/2-图文分类）
- `parent_id`: 父级分类ID（支持多级分类）
- `sort_order`: 排序顺序
- `icon`: 分类图标
- `description`: 分类描述
- `status`: 状态（禁用/启用）

**特点：**
- 支持视频和图文分类分别管理
- 支持多级分类结构（通过parent_id）
- 分类编码在同一租户下唯一（联合唯一索引）

#### 2. t_tag_group - 标签组信息表
管理标签组信息，标签组采用枚举方式。

**核心字段：**
- `group_code`: 标签组编码
- `group_name`: 标签组名称
- `group_type`: 标签组类型（video_material-视频素材标签组/image_material-图文素材标签组）
- `sort_order`: 排序顺序
- `description`: 标签组描述
- `status`: 状态

**特点：**
- 标签组采用枚举方式，支持扩展
- 不同业务模块有独立的标签组
- 便于标签的分类管理

#### 3. t_tag - 标签信息表
管理具体的标签信息。

**核心字段：**
- `tag_code`: 标签编码（唯一标识，业务表通过此字段关联）
- `tag_name`: 标签名称
- `tag_group_id`: 标签组ID
- `tag_color`: 标签颜色
- `sort_order`: 排序顺序
- `description`: 标签描述
- `status`: 状态

**特点：**
- 标签编码在同一租户下唯一
- 关联标签组实现分类管理
- 支持自定义标签颜色
- 业务表通过tag_code关联标签

---

### 2️⃣ 素材管理模块（3张表）

#### 4. t_video_material - 视频素材表
存储视频素材的基本信息和元数据。

**核心字段：**
- `material_name`: 视频名称
- `file_url`: 视频文件URL
- `file_size`: 文件大小
- `duration`: 视频时长
- `cover_url`: 封面图URL
- `category_id`: 分类ID（关联t_material_category表）
- `tag_codes`: 标签编码，多个用逗号分隔
- `permission_type`: 权限设置
- `status`: 状态（草稿/正常/已下架）

#### 5. t_image_material - 图文素材表
存储图文内容素材的信息。

**核心字段：**
- `title`: 图文标题
- `cover_url`: 封面图URL
- `content`: 图文内容
- `category_id`: 分类ID（关联t_material_category表）
- `tag_codes`: 标签编码，多个用逗号分隔
- `permission_type`: 权限设置
- `status`: 状态（草稿/已发布/审核中/已下架）

**变更说明：**
- 已移除 `platform_type` 字段（发布平台信息在发布任务中管理）
- 已移除 `location` 字段（地理位置不作为素材属性）

#### 6. t_material_image - 素材图片关联表
存储图文素材的多张内容图片。

**核心字段：**
- `material_id`: 关联的图文素材ID
- `image_url`: 图片URL
- `sort_order`: 排序顺序

---

### 3️⃣ 账号管理模块（2张表）

#### 7. t_account_group - 平台账号分组信息表
管理平台账号的分组信息。

**核心字段：**
- `group_code`: 分组编码
- `group_name`: 分组名称
- `sort_order`: 排序顺序
- `description`: 分组描述
- `status`: 状态

**特点：**
- 支持灵活的账号分组管理
- 分组编码在同一租户下唯一

#### 8. t_platform_account - 平台账号管理表
管理各个社交媒体平台的账号信息。

**核心字段：**
- `account_no`: 账号ID/编号
- `nickname`: 账号昵称
- `platform_type`: 平台类型（抖音/小红书/快手/微博/微信公众号）
- `group_id`: 所属分组ID（关联t_account_group表）
- `fans_count`: 粉丝数
- `status`: 状态（已掉线/正常/违规）
- `bind_time`: 绑定时间
- `auth_token`: 认证Token信息
- `permission_config`: 权限配置JSON

**变更说明：**
- 新增 `group_id` 字段，关联账号分组
- 新增 `auth_token` 字段，存储平台认证信息

---

### 4️⃣ 发布中心模块（1张表）

#### 9. t_publish_task - 发布任务表
管理图文和视频的发布任务及数据统计。

**核心字段：**
- `task_no`: 任务编号
- `task_type`: 任务类型（1-图文发布/2-视频发布）
- `material_id`: 素材ID
- `platform_type`: 发布平台
- `account_id`: 发布账号ID
- `plan_publish_time`: 计划发布时间
- `actual_publish_time`: 实际发布时间
- `status`: 状态（待发布/发布中/已成功/已失败）
- `platform_content_id`: 平台内容ID
- `view_count`: 浏览量
- `like_count`: 点赞数
- `comment_count`: 评论数
- `share_count`: 分享数
- `collect_count`: 收藏数
- `last_comment_time`: 最新评论时间

**变更说明：**
- 已移除 `account_name` 字段（通过account_id关联获取）
- 新增数据统计字段：浏览量、点赞数、评论数、分享数、收藏数
- 新增 `last_comment_time` 字段，记录最新评论时间

---

### 5️⃣ 交互管理模块（4张表）

#### 10. t_comment - 评论管理表
管理来自各平台的评论信息。

**核心字段：**
- `account_id`: 所属账号ID
- `publish_task_id`: 关联的发布任务ID
- `platform_content_id`: 平台内容ID
- `comment_user_name`: 评论用户昵称
- `comment_content`: 评论内容
- `comment_time`: 评论时间
- `has_sensitive_word`: 是否包含敏感词
- `status`: 状态（待处理/已回复/已忽略/已删除）
- `reply_content`: 回复内容
- `reply_time`: 回复时间

**变更说明：**
- 已移除 `account_name` 字段（通过account_id关联获取）
- 已移除 `content_title` 字段（通过publish_task_id关联获取）
- 新增 `publish_task_id` 字段，关联发布任务

#### 11. t_private_message - 私信管理表
管理私信消息记录。

**核心字段：**
- `account_id`: 所属账号ID
- `user_name`: 用户昵称
- `user_id`: 用户ID
- `message_type`: 消息类型（接收/发送）
- `content_type`: 内容类型（文本/图片/文件）
- `message_content`: 消息内容
- `send_time`: 发送时间
- `is_read`: 是否已读

**变更说明：**
- 已移除 `account_name` 字段（通过account_id关联获取）
- 已移除 `session_id` 字段（通过user_id和account_id组合标识会话）
- 新增 `user_id` 字段，用于标识用户

#### 12. t_lead - 线索收集表
收集和管理潜在客户线索。

**核心字段：**
- `lead_no`: 线索编号
- `user_name`: 用户昵称
- `phone`: 手机号
- `wechat_id`: 微信号
- `source_type`: 来源渠道（评论/私信/表单）
- `source_account_name`: 来源账号名称
- `collect_time`: 收集时间
- `follow_status`: 跟进状态（新线索/跟进中/已转化/无效）
- `is_synced_crm`: 是否已同步到CRM

#### 13. t_lead_follow_record - 线索跟进记录表
记录线索的跟进历史。

**核心字段：**
- `lead_id`: 线索ID
- `follow_content`: 跟进内容
- `follow_result`: 跟进结果
- `next_follow_time`: 下次跟进时间

---

### 6️⃣ 系统配置模块（1张表）

#### 14. t_sensitive_word - 敏感词配置表
配置评论和私信的敏感词过滤。

**核心字段：**
- `word`: 敏感词
- `word_type`: 敏感词类型
- `status`: 状态

---

## 🔑 标准字段说明

每个表都包含以下标准字段，用于审计和多租户管理：

| 字段 | 类型 | 说明 |
|------|------|------|
| `creator` | varchar(64) | 创建人 |
| `create_time` | datetime | 创建时间 |
| `updater` | varchar(64) | 更新人 |
| `update_time` | datetime | 更新时间 |
| `deleted` | bit(1) | 删除标识（软删除） |
| `tenant_id` | bigint | 租户ID（多租户隔离） |

## 📊 索引设计

### 主键索引
- 所有表都使用 `id` 作为主键，自增长

### 唯一索引
- `t_material_category.category_code` + `tenant_id` - 分类编码
- `t_tag_group.group_code` + `tenant_id` - 标签组编码
- `t_tag.tag_code` + `tenant_id` - 标签编码
- `t_account_group.group_code` + `tenant_id` - 账号分组编码
- `t_publish_task.task_no` - 发布任务编号
- `t_lead.lead_no` - 线索编号

### 普通索引
1. **多租户索引**：所有表都有 `tenant_id` 索引
2. **业务查询索引**：
   - 时间字段（`create_time`, `publish_time`, `comment_time` 等）
   - 状态字段（`status`）
   - 关联字段（`account_id`, `material_id`, `group_id` 等）
   - 分类字段（`category_id`, `platform_type` 等）

## 🔗 表关系说明

### 核心关联关系

```
t_tag_group (标签组)
    └─→ t_tag (标签)

t_material_category (素材分类)
    ├─→ t_video_material (视频素材)
    └─→ t_image_material (图文素材)

t_account_group (账号分组)
    └─→ t_platform_account (平台账号)

t_platform_account (账号)
    ├─→ t_publish_task (发布任务)
    ├─→ t_comment (评论)
    ├─→ t_private_message (私信)
    └─→ t_lead (线索)

t_video_material (视频素材)
    └─→ t_publish_task (发布任务)

t_image_material (图文素材)
    ├─→ t_material_image (关联图片)
    └─→ t_publish_task (发布任务)

t_publish_task (发布任务)
    └─→ t_comment (评论)

t_lead (线索)
    └─→ t_lead_follow_record (跟进记录)
```

### 一对多 (1:N) 关系

| 主表 | 从表 | 关系说明 |
|------|------|----------|
| `t_tag_group` | `t_tag` | 一个标签组包含多个标签 |
| `t_material_category` | `t_video_material` | 一个分类可以有多个视频素材 |
| `t_material_category` | `t_image_material` | 一个分类可以有多个图文素材 |
| `t_account_group` | `t_platform_account` | 一个分组包含多个账号 |
| `t_video_material` | `t_publish_task` | 一个视频素材可以有多个发布任务 |
| `t_image_material` | `t_material_image` | 一个图文素材包含多张图片 |
| `t_image_material` | `t_publish_task` | 一个图文素材可以有多个发布任务 |
| `t_platform_account` | `t_publish_task` | 一个账号可以有多个发布任务 |
| `t_platform_account` | `t_comment` | 一个账号下有多条评论 |
| `t_platform_account` | `t_private_message` | 一个账号下有多条私信 |
| `t_platform_account` | `t_lead` | 一个账号可以收集多个线索 |
| `t_publish_task` | `t_comment` | 一个发布任务可以有多条评论 |
| `t_lead` | `t_lead_follow_record` | 一个线索有多条跟进记录 |

### 多对一 (N:1) 关系

上述 1:N 关系的反向即为 N:1 关系

---

## 💡 设计特点

### 1. 统一表名前缀
- 所有表名以 `t_` 开头
- 符合规范命名约定
- 便于识别和管理

### 2. 标签系统
- 独立的标签组和标签表
- 标签组采用枚举方式，支持扩展
- 业务表通过 `tag_codes` 字段关联标签编码
- 支持一个对象打多个标签

### 3. 分组管理
- 素材分类支持多级分类
- 账号支持分组管理
- 标签支持分组管理

### 4. 数据集成
- 发布任务表集成数据统计功能
- 评论表关联发布任务
- 取消独立的数据统计表，从业务表中统计

### 5. 多租户支持
- 所有表都包含 `tenant_id` 字段
- 支持 SaaS 模式的数据隔离

### 6. 软删除机制
- 使用 `deleted` 字段实现软删除
- 保留历史数据，便于数据恢复和审计

### 7. 审计功能
- `creator` / `create_time` 记录数据创建信息
- `updater` / `update_time` 记录数据更新信息

### 8. 认证信息存储
- 平台账号表支持存储认证Token
- 使用 TEXT 类型支持长Token存储

---

## 📝 使用说明

### 导入数据库

```bash
# MySQL 命令行导入
mysql -u username -p database_name < database_schema.sql

# 或使用可视化工具（如 Navicat、DBeaver）直接执行 SQL 文件
```

### 字符集说明
- 数据库字符集：`utf8mb4`
- 排序规则：`utf8mb4_0900_ai_ci`
- 支持存储 emoji 等特殊字符

### 存储引擎
- 使用 InnoDB 存储引擎
- 支持事务和外键约束

---

## 🔄 数据流转示例

### 发布流程
1. 创建素材 → `t_video_material` 或 `t_image_material`
2. 选择账号 → `t_platform_account`
3. 创建发布任务 → `t_publish_task`
4. 发布成功后数据直接更新到 `t_publish_task` 表

### 线索收集流程
1. 用户评论 → `t_comment`
2. 识别意向客户 → 创建 `t_lead`
3. 跟进记录 → `t_lead_follow_record`
4. 同步CRM → 更新 `t_lead.is_synced_crm`

### 标签使用流程
1. 创建标签组 → `t_tag_group`
2. 在标签组下创建标签 → `t_tag`
3. 素材关联标签 → 在 `tag_codes` 字段中存储标签编码

---

## 📞 技术支持

如有任何问题，请参考：
- SQL文件：`database_schema.sql`
- 原型页面：`页面导航.html`

---

**版本**: v2.0  
**生成时间**: 2025-10-03  
**数据库类型**: MySQL 8.0+  
**表数量**: 14张
